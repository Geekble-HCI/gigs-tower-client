# Game Part - ESP32 센서 코드

삼양 팝업 게임의 물리적 센서 처리를 담당하는 ESP32 펌웨어들입니다.

## 💡 간단 요약
- **GEEKBLE_SEESAW**: 시소 게임 - 가속도 센서로 기울기 감지
- **GEEKBLE_GOAL**: 농구 게임 - 초음파 센서로 골인 감지  
- **GEEKBLE_BALL**: 볼풀 게임 - 8개 초음파 센서로 볼 감지

## 📁 구성

```
game-part/
├── GEEKBLE_SEESAW/    # 시소 게임 (게임 타입 5)
├── GEEKBLE_GOAL/      # 농구 게임 (게임 타입 6)
└── GEEKBLE_BALL/      # 볼풀 게임 (게임 타입 4)
```

## 🎯 펌웨어 설명

### GEEKBLE_SEESAW (시소 게임)
**용도**: 바이오데이터 에어시소 게임의 균형 감지

**센서**: 가속도계 (X/Y/Z 축)
- 시리얼1 통신으로 센서 데이터 수신 (115200 baud)
- X축 기울기 변화 감지 시 점수 전송
- bias 값으로 수평 보정 (-60)

**출력**:
- 기울기 방향 변경 시 → 시리얼로 `'1'` 전송
- 데드타임: 20ms (연속 감지 방지)

**핀 설정**:
```
Serial1 TX: 12번 핀
Serial1 RX: 13번 핀
```

### GEEKBLE_GOAL (농구 게임)
**용도**: 슛잇! 무빙 골대 게임의 골인 감지

**센서**: 초음파 센서 1개 (HC-SR04)
- 골대 근처 물체 감지
- 목표 거리: 2.8m 이내

**출력**:
- 골인 감지 시 → 시리얼로 `"10"` 전송
- 데드타임: 2초 (중복 감지 방지)

**핀 설정**:
```
TRIG: 6번 핀
ECHO: 3번 핀
```

### GEEKBLE_BALL (볼풀 게임)
**용도**: 볼볼볼 영양소 게임의 볼 감지

**센서**: 초음파 센서 8개 (HC-SR04)
- 8개 구역에서 동시 볼 감지
- 목표 거리: 2.65m 이내

**출력**:
- 각 센서별 볼 감지 시 → 시리얼로 `'2'` 전송
- 데드타임: 150ms (센서별 독립)

**핀 설정**:
```
TRIG 핀: 17,16,10,11,21,20,19,18
ECHO 핀: 6,7,8,9,2,3,4,5
```

## ⚙️ 설치 및 사용법

### 1. Arduino IDE 설정
```
보드: ESP32 Dev Module
업로드 속도: 115200
시리얼 모니터: 115200 baud
```

### 2. 하드웨어 연결

#### 시소 게임 (SEESAW)
- 가속도 센서를 Serial1에 연결
- TX(12), RX(13) 핀 사용

#### 농구 게임 (GOAL)
- HC-SR04 초음파 센서 1개
- TRIG(6) → ESP32 6번 핀
- ECHO(3) → ESP32 3번 핀

#### 볼풀 게임 (BALL)
- HC-SR04 초음파 센서 8개
- TRIG 핀: 17,16,10,11,21,20,19,18
- ECHO 핀: 6,7,8,9,2,3,4,5

### 3. 게임 클라이언트 연동

각 ESP32는 게임 클라이언트와 시리얼 통신으로 연결됩니다:

```python
# gigs-tower/Module/serial_handler.py에서 처리
if data.strip() == '1':    # 시소 점수
    self.score_manager.add_score(1)
elif data.strip() == '2':  # 볼풀 점수
    self.score_manager.add_score(2)  
elif data.strip() == '10': # 농구 점수
    self.score_manager.add_score(10)
```

## 🔧 설정 값

### 감지 거리 설정
- **농구 (GOAL)**: `d_goal = 2800` (2.8m)
- **볼풀 (BALL)**: `d_goal = 2650` (2.65m)

### 데드타임 설정
- **시소 (SEESAW)**: `dead_time = 20` (20ms)
- **농구 (GOAL)**: `dead_time = 2000` (2초)
- **볼풀 (BALL)**: `dead_time = 150` (150ms)

### 센서 주기
- **시소 (SEESAW)**: 100ms 주기로 시리얼 읽기
- **농구 (GOAL)**: 25ms 주기로 초음파 측정
- **볼풀 (BALL)**: 10ms 주기로 초음파 측정

## 🚨 주의사항

1. **전원**: ESP32에 안정적인 5V 전원 공급 필요
2. **초음파 센서**: 측정 범위와 장애물 고려
3. **시리얼 충돌**: 업로드 시 시리얼 모니터 종료
4. **센서 배치**: 각 게임의 물리적 구조에 맞게 센서 위치 조정

## 📊 점수 체계

| 게임 | 감지 이벤트 | 전송 값 | 점수 |
|------|-------------|---------|------|
| 시소 | 기울기 변화 | '1' | 1점 |
| 농구 | 골인 | "10" | 10점 |
| 볼풀 | 볼 감지 | '2' | 2점 |

이 ESP32 코드들은 각각의 물리적 게임 장치에 설치되어 실시간으로 센서 데이터를 처리하고 점수를 게임 클라이언트로 전송합니다.
